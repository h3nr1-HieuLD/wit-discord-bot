"use strict";var M=Object.create;var l=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var v=(t,c)=>{for(var d in c)l(t,d,{get:c[d],enumerable:!0})},f=(t,c,d,n)=>{if(c&&typeof c=="object"||typeof c=="function")for(let i of b(c))!C.call(t,i)&&i!==d&&l(t,i,{get:()=>c[i],enumerable:!(n=$(c,i))||n.enumerable});return t};var u=(t,c,d)=>(d=t!=null?M(k(t)):{},f(c||!t||!t.__esModule?l(d,"default",{value:t,enumerable:!0}):d,t)),T=t=>f(l({},"__esModule",{value:!0}),t);var q={};v(q,{default:()=>A});module.exports=T(q);var p=require("discord.js"),s=require("../../utils/getChannel"),y=u(require("lodash")),m=require("../../lib/client"),h=u(require("../../constants")),o=u(require("../../../../prisma/client")),w=require("../../utils/isAdmin");async function A(t){const c=m.DiscordClient.getInstance();if(t.author.bot)return;const d=t.guild?.id;if(t.content.startsWith("*meeting now")){const a=(await(0,s.getChannelIds)(d)).filter(e=>e instanceof p.VoiceChannel&&e.name!="Lofi Chill").map(e=>e.id),r=a.at(y.default.random(0,a.length-1));try{if(await o.default.discordAdminId.count({where:{discordId:t.author.id.toString()}}))try{await o.default.discordMeet.create({data:{joined:"",isActive:!0,channel:r}})}catch(I){await t.reply({content:`L\u01B0u meet v\xE0o database th\u1EA5t b\u1EA1i (id: ${r}, err: ${I.toString()})!`})}}catch{await t.reply({content:"Kh\xF4ng th\u1EC3 k\u1EBFt n\u1ED1i t\u1EDBi database!"})}await t.reply({content:`Meet t\u1EA1i ph\xF2ng <#${r}> !`})}else if(t.content.startsWith("*add_member"))try{if(!await(0,w.isAdmin)(t.author.id)){await t.reply({content:"Kh\xF4ng ph\u1EA3i admin!"});return}const n=t.mentions.users;await o.default.discordMember.createMany({data:n.map(i=>({discordId:i.id}))}),await t.reply({content:`\u0110\xE3 th\xEAm ${n.size} th\xE0nh vi\xEAn`})}catch(n){await t.reply({content:`C\xF3 l\u1ED7i x\u1EA3y ra ${n.toString()}`})}else if(t.content.includes("@")){const i=t.mentions.users.map(r=>r.id),a=c.channels.cache.find(r=>r.id===h.default.notifyChannel);i.forEach(r=>{a.send(`<@${t.author.id}> \u0111\xE3 tag <@${r}> t\u1EA1i channel <#${t.channelId}>`)})}else if(t.content.includes("*quydinh"))await t.reply({content:h.quydinh});else if(t.content==="*id")await t.reply({content:t.author.id});else if(t.content==="*channelId")await t.reply({content:t.channelId});else if(t.content==="*checkin"){const n=t.channelId;try{const i=await o.default.discordMeet.findUnique({where:{channel:n,isActive:!0}});if(!i){await t.reply({content:"Meeting kh\xF4ng t\u1ED3n t\u1EA1i..."});return}const a=i.joined.split(" ");if(a.includes(t.author.id)){await t.reply({content:"B\u1EA1n \u0111\xE3 \u0111i\u1EC3m danh tr\u01B0\u1EDBc \u0111\xF3 r\u1ED3i..."});return}await o.default.discordMeet.update({where:{id:i.id},data:{joined:[...a,t.author.id].join(" ")}}),await t.reply({content:"\u0110\xE3 \u0111i\u1EC3m danh th\xE0nh c\xF4ng"})}catch(i){await t.reply({content:`\u0110\xE3 \u0111i\u1EC3m danh th\u1EA5t b\u1EA1i (error: ${i.toString()})`})}}else if(t.content=="*checkedin")try{const n=await o.default.discordMeet.findUnique({where:{channel:t.channel.id,isActive:!0}});if(!n)await t.reply({content:"Meeting kh\xF4ng t\u1ED3n t\u1EA1i..."});else{const i=n.joined.split(" ");let a="";for(let r=1;r<i.length;r++)a+=` <@${i[r]}>`;await t.reply({content:`Danh s\xE1ch \u0111i\u1EC3m danh (${i.length-1}): ${a}`})}}catch(n){await t.reply({content:`L\u1EA5y danh s\xE1ch th\u1EA5t b\u1EA1i! (error: ${n.toString()})`})}else if(t.content==="*end meeting")try{if(!await(0,w.isAdmin)(t.author.id)){await t.reply({content:"Kh\xF4ng ph\u1EA3i admin!"});return}const n=await o.default.discordMeet.findUnique({where:{channel:t.channel.id,isActive:!0}});if(!n){await t.reply({content:"Meeting kh\xF4ng t\u1ED3n t\u1EA1i..."});return}const i=await o.default.discordMember.findMany(),a=c.channels.cache.find(e=>e.id===h.default.notifyChannel),r=n.joined.split(" ");for(const e of i)r.includes(e.discordId)||(e.missTime==2?(await t.guild.members.kick(e.discordId,"Kick do qu\xE1 2 l\u1EA7n kh\xF4ng tham gia meet!"),await a.send(`<@${e.discordId}> aka ${e.username} \u0111\xE3 b\u1ECB KICK kh\u1ECFi nh\xF3m do qu\xE1 2 l\u1EA7n kh\xF4ng tham gia meet.`),await o.default.discordMember.update({where:{discordId:e.discordId},data:{missTime:0}})):(a.send(`C\u1EA3nh b\xE1o: <@${e.discordId}> kh\xF4ng tham gia meeting l\xFAc ${new Date(n.createdAt).toLocaleString("vi-VN")}, qu\xE1 2 l\u1EA7n, b\u1EA1n s\u1EBD t\u1EF1 \u0111\u1ED9ng b\u1ECB KICK!}`),await o.default.discordMember.update({where:{discordId:e.discordId},data:{missTime:e.missTime+1}})));await o.default.discordMeet.delete({where:{channel:t.channel.id}}),await t.reply({content:"Bu\u1ED5i meet \u0111\xE3 k\u1EBFt th\xFAc! C\u1EA3m \u01A1n c\xE1c b\u1EA1n \u0111\xE3 tham gia..."})}catch(n){await t.reply({content:`C\xF3 l\u1ED7i x\u1EA3y ra ${n.toString()}`})}}
